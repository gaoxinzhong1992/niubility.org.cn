---
layout: post
title: "Jvm内存结构"
date: 2019-08-21 18:52:51
categories: Java
---

jvm内存结构

## 1.概述

Java虚拟机在运行Java程序时，把它所管理的内存划分为若干个不同的数据区域，主要包括以下五个部分：程序计数器、Java堆、Java虚拟机栈、方法区和本地方法栈。

![jvm内存结构](https://niubility.org.cn/assets/images/jvm201908195.png)

## 2.程序计数器（Program Counter Register）

一块较小的内存空间，它是当前线程所执行的字节码的行号指示器，字节码解释器工作时通过改变计数器的值来选择下一条需要执行的字节码指令，分支、跳转、循环等基础功能都要依赖它实现。```每个线程都有一个独立的程序计数器，各线程间的计数器互不影响，因此该区域是线程私有的。```

当线程执行一个Java方法时，该计数器记录的是正在执行的虚拟机字节码指令的地址，当线程执行的是Native方法（调用本地操作系统方法）时，该计数器的值为空。另外，```该内存区域是唯一一个在Java虚拟机规范中没有规定任何OOM（内存溢出：OutMemoryError）情况的区域。```

## 3.Java虚拟机栈（Java Virtual Machine Stack）

```该区域也是线程私有的，它的生命周期与线程相同。```虚拟机描述的是Java方法执行的内存模型，每个方法被执行的时候都会同时创建一个栈桢，栈它是用于支持虚拟机进行方法调用和方法执行的数据结构。对于执行引擎来说，活动线程中，只有栈顶的栈桢是有效的，称为当前栈桢，这个栈桢所关联的方法称为当前方法，执行引擎所运行的所有字节码指令都只针对当前栈桢进行操作。```栈桢用于存储局部变量、操作数栈、动态链接、方法返回地址和一些额外的附加信息。在编译程序代码时，栈桢需要多大局部变量表、多深的操作数栈都已经完全确定，并且写入方法表的code属性之中。```因此一个栈桢需要分配多少内存，不会收到程序运行器变量数据的影响，仅仅取决于具体的虚拟机实现。

> 在Java虚拟机规范中，该区域规定了两种异常情况：

- 1.如果线程请求的栈深度大于虚拟机所允许的深度，将抛出```StackOverflowError```异常.
- 2.如果虚拟机在动态扩展栈时无法申请到足够的内存空间，则抛出```OutOfMemoryError```异常。

### 3.1 局部变量表

### 3.2 操作数栈

### 3.3 动态链接

### 3.4 方法返回地址

## 4.本地方法栈（Native Method Stack）

## 5.Java堆（Java Heap）

## 6.方法区（Method Area）

